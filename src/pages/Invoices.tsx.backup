import { PageHeader } from "@/components/PageHeader";
import { Card } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { FileText, Download, Eye, CheckCircle, Clock, AlertCircle } from "lucide-react";

export default function Invoices() {
  const invoices = [
    { id: "NFE-001234", type: "NF-e", customer: "João Silva", value: "R$ 2,459.90", status: "issued", date: "2025-11-08", taxId: "12345678901234" },
    { id: "NFCE-005678", type: "NFC-e", customer: "Maria Santos", value: "R$ 459.50", status: "processing", date: "2025-11-08", taxId: "98765432109876" },
    { id: "NFSE-009012", type: "NFS-e", customer: "TechCorp Ltda", value: "R$ 8,999.00", status: "issued", date: "2025-11-07", taxId: "11223344556677" },
    { id: "NFE-001235", type: "NF-e", customer: "Pedro Costa", value: "R$ 1,299.00", status: "error", date: "2025-11-07", taxId: "22334455667788" },
    { id: "NFCE-005679", type: "NFC-e", customer: "Ana Oliveira", value: "R$ 349.90", status: "issued", date: "2025-11-06", taxId: "33445566778899" },
    { id: "NFE-001236", type: "NF-e", customer: "Carlos Mendes", value: "R$ 5,670.80", status: "processing", date: "2025-11-06", taxId: "44556677889900" },
  ];

  const bulkInvoices = [
    { batch: "BATCH-2025-001", marketplace: "Mercado Livre", orders: 45, total: "R$ 12,890.50", status: "completed", date: "2025-11-08" },
    { batch: "BATCH-2025-002", marketplace: "Shopee", orders: 32, total: "R$ 8,234.20", status: "processing", date: "2025-11-08" },
    { batch: "BATCH-2025-003", marketplace: "Amazon", orders: 28, total: "R$ 15,670.90", status: "completed", date: "2025-11-07" },
  ];

  const getStatusIcon = (status: string) => {
    switch (status) {
      case "issued":
      case "completed":
        return <CheckCircle className="h-4 w-4 text-success" />;
      case "processing":
        return <Clock className="h-4 w-4 text-warning" />;
      case "error":
        return <AlertCircle className="h-4 w-4 text-destructive" />;
      default:
        return null;
    }
  };

  const getStatusBadge = (status: string) => {
    const variants: Record<string, string> = {
      issued: "bg-success/10 text-success",
      completed: "bg-success/10 text-success",
      processing: "bg-warning/10 text-warning",
      error: "bg-destructive/10 text-destructive",
    };
    return variants[status] || "bg-muted text-muted-foreground";
  };

  return (
    <div className="min-h-screen">
      <PageHeader
        title="Automatic Invoice Issuance"
        description="Generate and manage NF-e, NFC-e, and NFS-e invoices with SEFAZ integration"
        backgroundImage="https://images.unsplash.com/photo-1554224155-6726b3ff858f?auto=format&fit=crop&q=80&w=2000"
      />

      <div className="container mx-auto px-6 py-8">
        {/* Stats Cards */}
        <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
          <Card className="p-6 shadow-soft">
            <div className="flex items-center justify-between mb-2">
              <span className="text-sm text-muted-foreground">Issued Today</span>
              <CheckCircle className="h-5 w-5 text-success" />
            </div>
            <p className="text-2xl font-bold">127</p>
            <p className="text-xs text-muted-foreground mt-1">+15% from yesterday</p>
          </Card>
          <Card className="p-6 shadow-soft">
            <div className="flex items-center justify-between mb-2">
              <span className="text-sm text-muted-foreground">Processing</span>
              <Clock className="h-5 w-5 text-warning" />
            </div>
            <p className="text-2xl font-bold">23</p>
            <p className="text-xs text-muted-foreground mt-1">Average wait: 2min</p>
          </Card>
          <Card className="p-6 shadow-soft">
            <div className="flex items-center justify-between mb-2">
              <span className="text-sm text-muted-foreground">Total Value</span>
              <FileText className="h-5 w-5 text-primary" />
            </div>
            <p className="text-2xl font-bold">R$ 45,890</p>
            <p className="text-xs text-muted-foreground mt-1">Today's invoices</p>
          </Card>
          <Card className="p-6 shadow-soft">
            <div className="flex items-center justify-between mb-2">
              <span className="text-sm text-muted-foreground">Errors</span>
              <AlertCircle className="h-5 w-5 text-destructive" />
            </div>
            <p className="text-2xl font-bold">3</p>
            <p className="text-xs text-muted-foreground mt-1">Requires attention</p>
          </Card>
        </div>

        {/* Main Content */}
        <Tabs defaultValue="individual" className="space-y-6">
          <TabsList>
            <TabsTrigger value="individual">Individual Invoices</TabsTrigger>
            <TabsTrigger value="bulk">Bulk Invoicing</TabsTrigger>
          </TabsList>

          <TabsContent value="individual" className="space-y-6">
            <Card className="p-6 shadow-soft">
              <div className="flex items-center justify-between mb-6">
                <h3 className="text-lg font-semibold">Recent Invoices</h3>
                <Button>
                  <FileText className="h-4 w-4 mr-2" />
                  New Invoice
                </Button>
              </div>
              <div className="overflow-x-auto">
                <table className="w-full">
                  <thead>
                    <tr className="border-b border-border">
                      <th className="text-left py-3 px-4 text-sm font-medium text-muted-foreground">Invoice ID</th>
                      <th className="text-left py-3 px-4 text-sm font-medium text-muted-foreground">Type</th>
                      <th className="text-left py-3 px-4 text-sm font-medium text-muted-foreground">Customer</th>
                      <th className="text-left py-3 px-4 text-sm font-medium text-muted-foreground">Tax ID</th>
                      <th className="text-left py-3 px-4 text-sm font-medium text-muted-foreground">Value</th>
                      <th className="text-left py-3 px-4 text-sm font-medium text-muted-foreground">Date</th>
                      <th className="text-left py-3 px-4 text-sm font-medium text-muted-foreground">Status</th>
                      <th className="text-left py-3 px-4 text-sm font-medium text-muted-foreground">Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    {invoices.map((invoice) => (
                      <tr key={invoice.id} className="border-b border-border hover:bg-muted/30 transition-colors">
                        <td className="py-3 px-4 font-medium">{invoice.id}</td>
                        <td className="py-3 px-4">
                          <Badge variant="outline">{invoice.type}</Badge>
                        </td>
                        <td className="py-3 px-4">{invoice.customer}</td>
                        <td className="py-3 px-4 text-sm text-muted-foreground">{invoice.taxId}</td>
                        <td className="py-3 px-4 font-medium">{invoice.value}</td>
                        <td className="py-3 px-4 text-sm">{invoice.date}</td>
                        <td className="py-3 px-4">
                          <div className="flex items-center gap-2">
                            {getStatusIcon(invoice.status)}
                            <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getStatusBadge(invoice.status)}`}>
                              {invoice.status}
                            </span>
                          </div>
                        </td>
                        <td className="py-3 px-4">
                          <div className="flex items-center gap-2">
                            <Button variant="ghost" size="sm">
                              <Eye className="h-4 w-4" />
                            </Button>
                            <Button variant="ghost" size="sm">
                              <Download className="h-4 w-4" />
                            </Button>
                          </div>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </Card>
          </TabsContent>

          <TabsContent value="bulk" className="space-y-6">
            <Card className="p-6 shadow-soft">
              <div className="flex items-center justify-between mb-6">
                <div>
                  <h3 className="text-lg font-semibold">Bulk Invoice Batches</h3>
                  <p className="text-sm text-muted-foreground">Process multiple marketplace orders at once</p>
                </div>
                <Button>
                  <FileText className="h-4 w-4 mr-2" />
                  New Batch
                </Button>
              </div>
              <div className="space-y-4">
                {bulkInvoices.map((batch) => (
                  <Card key={batch.batch} className="p-4 border border-border">
                    <div className="flex items-center justify-between">
                      <div className="flex-1">
                        <div className="flex items-center gap-3 mb-2">
                          <h4 className="font-semibold">{batch.batch}</h4>
                          <Badge variant="outline">{batch.marketplace}</Badge>
                          <div className="flex items-center gap-1">
                            {getStatusIcon(batch.status)}
                            <span className={`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getStatusBadge(batch.status)}`}>
                              {batch.status}
                            </span>
                          </div>
                        </div>
                        <div className="flex items-center gap-6 text-sm text-muted-foreground">
                          <span>{batch.orders} orders</span>
                          <span className="font-medium text-foreground">{batch.total}</span>
                          <span>{batch.date}</span>
                        </div>
                      </div>
                      <div className="flex items-center gap-2">
                        <Button variant="outline" size="sm">
                          <Eye className="h-4 w-4 mr-2" />
                          View Details
                        </Button>
                        <Button variant="outline" size="sm">
                          <Download className="h-4 w-4 mr-2" />
                          Download All
                        </Button>
                      </div>
                    </div>
                  </Card>
                ))}
              </div>
            </Card>

            {/* Tax Calculation Info */}
            <Card className="p-6 shadow-soft bg-primary/5 border-primary/20">
              <h4 className="font-semibold mb-3 flex items-center gap-2">
                <CheckCircle className="h-5 w-5 text-primary" />
                SEFAZ Integration Active
              </h4>
              <p className="text-sm text-muted-foreground mb-2">
                All invoices are automatically validated and submitted to SEFAZ. Tax calculations include:
              </p>
              <ul className="text-sm text-muted-foreground space-y-1 ml-4">
                <li>• ICMS (State Tax) - Automatically calculated based on NCM and state</li>
                <li>• PIS/COFINS (Federal Taxes) - Applied according to tax regime</li>
                <li>• IPI (Industrialized Products Tax) - When applicable</li>
                <li>• ISS (Service Tax) - For NFS-e invoices</li>
              </ul>
            </Card>
          </TabsContent>
        </Tabs>
      </div>
    </div>
  );
}
